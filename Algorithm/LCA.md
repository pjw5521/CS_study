## ****LCA(Lowest Common Ancestor) ì•Œê³ ë¦¬ì¦˜****

---

ìµœì†Œ ê³µí†µ ì¡°ìƒ ì•Œê³ ë¦¬ì¦˜

â‡’ ë‘ ë…¸ë“œì˜ ê³µí†µëœ ì¡°ìƒ ì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ì¡°ìƒì„ ì°¾ëŠ” ì•Œê³ ë¦¬ì¦˜

![lca](https://user-images.githubusercontent.com/67946662/168473528-c1365763-9b92-4303-9810-53adfdb4bde6.png)


### ë™ì‘ìˆœì„œ

1. ëª¨ë“  ë…¸ë“œì— ëŒ€í•œ ê¹Šì´ë¥¼ ê³„ì‚°í•œë‹¤.
2. ìµœì†Œ ê³µí†µ ì¡°ìƒì„ ì°¾ì„ ë‘ ë…¸ë“œë¥¼ í™•ì¸í•œë‹¤.
3. ë¨¼ì € ë‘ ë…¸ë“œì˜ ê¹Šì´ê°€ ë™ì¼í•˜ë„ë¡ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°„ë‹¤.
4. ë¶€ëª¨ê°€ ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ë°˜ë³µì ìœ¼ë¡œ ë‘ ë…¸ë“œì˜ ë¶€ëª¨ ë°©í–¥ìœ¼ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°„ë‹¤.
5. ëª¨ë“  LCA(a, b) ì—°ì‚°ì— ëŒ€í•˜ì—¬ 3~4ë²ˆì˜ ê³¼ì •ì„ ë°˜ë³µí•œë‹¤.

```python
// ë‘ ì •ì ì˜ depth í™•ì¸í•˜ê¸°
while True:
	if (depthê°€ ì¼ì¹˜):
		if (ë‘ ì •ì ì˜ parent ì¼ì¹˜?): LCA ì°¾ìŒ(ì¢…ë£Œ)
        else: ë‘ ì •ì ì„ ìì‹ ì˜ parent ì •ì  ê°’ìœ¼ë¡œ ë³€ê²½
    else: // depth ë¶ˆì¼ì¹˜
        ë” depthê°€ ê¹Šì€ ì •ì ì„ í•´ë‹¹ ì •ì ì˜ parent ì •ì ìœ¼ë¡œ ë³€ê²½(depthê°€ ê°ì†Œë¨)
}
```

### ì‹œê°„ë³µì¡ë„

- ë§¤ ì¿¼ë¦¬ë§ˆë‹¤ ë¶€ëª¨ ë°©í–¥ìœ¼ë¡œ ê±°ìŠ¬ë¡œ ì˜¬ë¼ê°€ê¸° ìœ„í•´ ìµœì•…ì˜ ê²½ìš°Â *O*(*N*)ì˜ ì‹œê°„ ë³µì¡ë„ê°€ ìš”êµ¬ë©ë‹ˆë‹¤. (í•œìª½ì— ì¹˜ìš°ì³ì„œ ì¼ë ¬ë¡œ ëœ ë…¸ë“œì¸ ê²½ìš°)
- ë”°ë¼ì„œ ëª¨ë“  ì¿¼ë¦¬(M)ë¥¼ ì²˜ë¦¬í•  ë•Œì˜ ì‹œê°„ ë³µì¡ë„ëŠ”Â *O*(*NM*)ì…ë‹ˆë‹¤.

### ê°œì„ ëœ LCA ì•Œê³ ë¦¬ì¦˜

- ê° ë…¸ë“œê°€ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ëŠ” ì†ë„ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“œëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
- 15ì¹¸ì„ ì˜¬ë¼ê°€ë©´ 8ì¹¸ ğŸ – 4ì¹¸ ğŸ – 2ì¹¸ ğŸ – 1ì¹¸
- 2ì˜ ì œê³± í˜•íƒœë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë„ë¡ í•˜ë©´Â *O*(*logN*)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë©”ëª¨ë¦¬ë¥¼ ë” ì‚¬ìš©í•˜ì—¬ ê° ë…¸ë“œì— ëŒ€í•˜ì—¬Â 2*i*ë²ˆì§¸ ë¶€ëª¨ì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.
- ì¦‰, ê³µê°„ ë³µì¡ë„ë¥¼ ëŠ˜ë¦¬ê³  ì‹œê°„ ë³µì¡ë„ë¥¼ ì¤„ì´ëŠ” trade-off

### ê°œì„ ëœ LCA ì•Œê³ ë¦¬ì¦˜ ì‹œê°„ ë³µì¡ë„

- ë‹¤ì´ë‚˜ë¯¹ í”„ë¡œê·¸ë˜ë°(DP)ë¥¼ ì´ìš©í•´ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë§¤ ì¿¼ë¦¬(M)ë§ˆë‹¤ ë¶€ëª¨ë¥¼ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ê¸° ìœ„í•´Â *O*(*logN*)ì˜ ë³µì¡ë„ê°€ í•„ìš”í•©ë‹ˆë‹¤.
- ëª¨ë“  ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•  ë•Œì˜ ì‹œê°„ ë³µì¡ë„ëŠ”Â *O*(*MlogN*)ì…ë‹ˆë‹¤.

### LCA ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„

[https://www.acmicpc.net/problem/11437](https://www.acmicpc.net/problem/11437)

```python
import sys
sys.setrecursionlimit(int(1e5)) # ëŸ°íƒ€ì„ ì˜¤ë¥˜ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ì¬ê·€ ê¹Šì´ ì œí•œ ì„¤ì •

n = int(input())

parent = [0] * (n + 1) # ë¶€ëª¨ ë…¸ë“œ ì •ë³´
d = [0] * (n + 1) # ê° ë…¸ë“œê¹Œì§€ì˜ ê¹Šì´
c = [0] * (n + 1) # ê° ë…¸ë“œì˜ ê¹Šì´ê°€ ê³„ì‚°ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€
graph = [[] for _ in range(n + 1)] # ê·¸ë˜í”„(graph) ì •ë³´

for _ in range(n - 1):
    a, b = map(int, input().split())
    graph[a].append(b)
    graph[b].append(a)

# ë£¨íŠ¸ ë…¸ë“œë¶€í„° ì‹œì‘í•˜ì—¬ ê¹Šì´(depth)ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜
def dfs(x, depth):
    c[x] = True
    d[x] = depth
    for y in graph[x]:
        if c[y]: # ì´ë¯¸ ê¹Šì´ë¥¼ êµ¬í–ˆë‹¤ë©´ ë„˜ê¸°ê¸°
            continue
        parent[y] = x
        dfs(y, depth + 1)

# Aì™€ Bì˜ ìµœì†Œ ê³µí†µ ì¡°ìƒì„ ì°¾ëŠ” í•¨ìˆ˜
def lca(a, b):
    # ë¨¼ì € ê¹Šì´(depth)ê°€ ë™ì¼í•˜ë„ë¡
    while d[a] != d[b]:
        if d[a] > d[b]:
            a = parent[a]
        else:
            b = parent[b]
    # ë…¸ë“œê°€ ê°™ì•„ì§€ë„ë¡
    while a != b:
        a = parent[a]
        b = parent[b]
    return a

dfs(1, 0) # ë£¨íŠ¸ ë…¸ë“œëŠ” 1ë²ˆ ë…¸ë“œ

m = int(input())

for i in range(m):
    a, b = map(int, input().split())
    print(lca(a, b))
```
