## 캐시메모리

- 캐시 메모리는 CPU 사이에 존재하며 캐시 메모리에 데이터가 존재한다면 메모리에 접근할 필요가 없으므로 성능상 이점을 얻을 수 있음
- 어떤 프로그램을 동작시키기 위해서는 메모리에 적재가 되고 CPU를 할당받아야 동작이 된다. 
이때 CPU와 메모리(RAM) 사이에서 활발하게 데이터를 주고받게 되는데 CPU에 비해 비교적 속도가 느린 메모리에 의해서 제대로 성능을 내지 못한다.
- 캐시 메모리는 **CPU와 RAM 사이에서 발생하는 병목 현상을 완화**하고자 사용
- **적중률 (Hit Rate)**
    - CPU는 메모리에 접근하기 전에 캐시 메모리를 먼저 들러 찾고자 하는 데이터가 있는지 확인한다.
        - 필요한 데이터를 찾았을 때 : 적중 (Cache Hit)
        - 필요한 데이터를 찾지 못했을 때 : 실패 (Cache Miss)
    - 요청한 데이터를 캐시 메모리에서 찾을 확률을 캐시 적중률 (cache hit ratio)이라고 하며 캐시 메모리의 성능은 적중률에 의해 결정된다.
        
        `적중률 = 캐시 메모리의 적중 횟수 / 전체 메모리의 참조 횟수`
        
    - CPU는 데이터를 가져오기 위해서 **캐시 메모리 > 주기억장치(Memory) > 보조기억장치(Disk)** 순으로 접근한다.
    
    ![https://mangchhe.github.io/assets/postImages/CacheMemory/dataFlowChart.png](https://mangchhe.github.io/assets/postImages/CacheMemory/dataFlowChart.png)
    
    - Cache Hit 할 경우 : 캐시 메모리에서 데이터를 CPU 레지스터에 복사한다.
    - Cache Miss & 메모리에서 찾았을 경우 : 메모리의 데이터를 캐시 메모리에 복사하고, 캐시 메모리에 복제된 내용을 CPU 레지스터에 복사한다.
    - Cache Miss & 메모리에서 찾지 못했을 경우 : 보조기억장치에서 메모리에 적재하고 적재된 내용을 캐시 메모리에 복사한다. 그리고 캐시 메모리의 데이터를 CPU 레지스터에 복사한다.
    

## 지역성

- 데이터에 대한 접근이 시각적, 공간적으로 가깝게 발생하는 것.
- 캐시의 적중률(Hit Rate)을 극대화하여 캐시가 효율적으로 동작하기 위해 사용되는 성질
- 배경 : 캐시 메모리에 최대한 많은 데이터를 넣으면 좋은 성능을 낼 수 있겠지만 그게 가능했다면 주기억장치와 같은 저장 매체는 필요로 하지도 않았을 것. 담을 수 있는 데이터는 많지 않기 때문에 자주 사용될 것 같은 데이터를 담는 것이 좋음. 이때 사용하는 것이 캐시의 지역성(Cache Locality)
    - **시간적 지역성** : 사용되었던 데이터가 가까운 시일 내에 한 번 더 사용될 가능성이 큰 성질
    - **공간적 지역성** : 사용되었던 데이터의 인접 데이터가 사용될 가능성이 큰 성질
    - **순차적 지역성** : 분기가 발생하지 않는 이상 순차적으로 실행될 가능성이 큰 성질

## ****Caching line****

- 캐시에 데이터를 저장할 때 특정 자료구조를 사용하여 `묶음`으로 저장하게 되는데 이를 **캐싱 라인** 이라고 한다. 프로세스는 다양한 주소에 있는 데이터를 사용하므로 빈번하게 사용하는 데이터의 주소 또한 흩어져 있다. 따라서 캐시에 저장하는 데이터에는 데이터의 메모리 주소 등을 기록해 둔 태그를 달아놓을 필요가 있다. 이러한 태그들의 묶음을 캐싱 라인이라고 하고 메모리로부터 가져올 때도 캐싱 라인을 기준으로 가져온다. 종류로는 대표적으로 세 가지 방식이 존재한다.
1. **Full Associative Mapping**
    1. 캐시 메모리의 빈 공간에 마음대로 주소를 저장하는 방식
    2. 장점 : 저장이 편리
    3. 단점 : 원하는 데이터가 있는지 찾기 위해서는 모든 태그를 병렬적으로 검사해야 하기 때문에 복잡, 비용 높음
2. **Direct Mapping**
    1. 메인 메모리를 일정한 크기의 블록으로 나누어 각각의 블록을 캐시의 정해진 위치에 매핑하는 방식
    2. 장점 : 가장 간단하고 구현 쉬움
    3. 단점 : 적중률(Hit Rate)이 낮아질 수 있음. 동일한 캐시 메모리에 할당된 여러 데이터를 사용할 때 충돌 발생
3. **Set Associative Mapping**
    1. Direct Mapping과 Full Associative Mapping의 장점을 결합한 방식
    2. 빈 공간에 마음대로 주소를 저장하되, 미리 정해둔 특정 행에만 저장하는 방식
    3. Direct에 비해 검색 속도는 느리지만 저장이 빠르고, Full에 비해 저장이 느리지만 검색이 빠름 ⇒ 주로 사용하는 방식
