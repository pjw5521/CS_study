## NoSQL

- NoSQL은 Not Only SQL의 약자로 기존 RDBMS 형태의 관계형 데이터베이스가 아닌 다른 형태의 데이터 저장 기술을 의미하며, 관계형 데이터 베이스의 한계를 극복하기 위한 데이터 저장소의 새로운 형태로, **수평적 확장성**을 갖고 있다.
- 관계형 데이터 모델을 **지양** 하며 대량의 분산된 데이터를 저장하고 조회하는 데 특화되었으며 스키마 없이 사용 가능하거나 느슨한 스키마를 제공하는 저장소를 말한다.
- 종류마다 쓰기/읽기 성능 특화, 2 차 인덱스 지원, 오토 샤딩 지원 같은 고유한 특징을 가진다. 대량의 데이터를 빠르게 처리하기 위해 메모리에 임시 저장하고 응답하는 등의 방법을 사용한다. 동적인 스케일 아웃을 지원하기도 하며, 가용성을 위하여 데이터 복제 등의 방법으로 관계형 데이터베이스가 제공하지 못하는 성능과 특징을 제공한다.

## NoSQL의 특징

- **NoSQL은 RDBMS와는 달리 데이터 간의 관계를 정의하지 않는다**.
    - 가장 큰 특징 중 하나는 관계형 데이터 베이스인 RDBMS가 데이터의 관계를 Foreign Key 등으로 정의하고 이를 이용해 Join 등의 관계형 연산을 한다고 하면,
    - NoSQL은 데이터 간의 관계를 정의하지 않는다. 데이터 테이블은 그냥 하나의 테이블이며 각 테이블 간의 관계를 정의하지 않고 일반적으로 테이블 간의 Join도 불가능하다.
- **RDBMS에 비해 훨씬 더 대용량의 데이터를 저장할 수 있다**.
    - RDBMS의 복잡도와 용량의 한계를 극복하기 위한 목적으로 등장한 만큼 페타바이트급의 대용량 데이터를 저장할 수 있다.
- **분산형 구조이다**.
    - NoSQL은 기존 RDBMS와는 다르게 하나의 고성능 머신에 데이터를 저장하는 것이 아니라 **일반적인 서버 수십 대를 연결해 데이터를 저장 및 처리하는 구조**를 갖는다.즉 분산형 구조를 통해 데이터를 여러 대의 서버에 분산해 저장하고 분산 시에 데이터를 상호 복제해 특정 서버에 장애가 발생했을 때에도 데이터 유실이나 서비스 중지가 없는 구조의 형태를 가진다.
- **고정되지 않은 테이블 스키마를 갖는다**.
    - RDBMS와는 다르게 테이블의 스키마가 유동적이다. 데이터를 저장하는 컬럼은 각기 다른 이름과 다른 데이터 타입을 갖는 것이 허용된다.
    - **스키마**란? **데이터베이스의 구조와 제약 조건에 관한 전반적인 명세를 기술한 메타데이터의 집합이다.**
    

---

## CAP 이론


![https://user-images.githubusercontent.com/14002238/112651209-86533680-8e8f-11eb-9579-2d9a2389ce27.png](https://user-images.githubusercontent.com/14002238/112651209-86533680-8e8f-11eb-9579-2d9a2389ce27.png)

- CAP 정리에 의하면 시스템은 일관성(Consistency), 가용성(Availablity), 분단 허용성(Partition torlerance) 분산 데이터베이스 시스템 세 가지 속성중에서, 두 가지만 가질 수 있다는 것이다.
- 위의 그림에서 볼 수 있듯이, Consistency, Availablity를 합치면, `CA` 또는 Consistency와 Partition tolerance를 조합하면 `CP`가 된다.
- 이 모든 속성을 다 포함한 시스템은 절대로 존재할 수 없다는 것이 CAP 정리이다.

### 각 특징의 의미

- **일관성(Consistency) 
[모든 요청은 최신 데이터 또는 에러를 응답받는다]**
    
    : 데이터를 저장하는 장비가 1대 든 100대든 모든 장비에서 동일한 데이터가 저장되어 있어야 한다는 것이다. `ACID` 원리에서 의미하는 것과 같다. 어떤 데이터베이스 속성에 `C`가 있다면, 트랜잭션 기능 또는 그와 비슷한 매커니즘이 존재한다는 뜻이다.
    
- **가용성(Availablity)
[모든 요청은 정상 응답을 받는다]**
 : 가용성은 죽지 않은 상태의 모든 서버는 클라이언트에게 항상 정상 처리 응답을 보애주어야 한다는 것을 의미한다. 클라이언트가 읽기, 쓰기 요청을 하면 제대로 읽고 쓰는 작업을 해야한다. 현재 시스템에 문제가 있어서 읽을 수 없다고 보내면 가용성이 보장되지 않는 것을 뜻한다.
- **분단 허용성(Partition tolerance) 
[노드간 통신이 실패하는 경우라도 시스템은 정상 동작한다]**
: 분단 허용성은 클러스터가 여러 대 동작하고 있을 때, 해당 클러스터 사이에 접속이 단절되어 서로 통신을 할 수 없는 상황에서도 시스템이 잘 동작해야 한다는 것이다.

**관계형 데이터베이스는 CA 시스템이다. 일관성(C)와 가용성(A)를 보장하되, 분단 허용성(P)는 보장하지 않는다**

> 관계형 데이터베이스가 동시에 다량의 서버를 운용하는 클러스터링에 적합하지 않는 이유가 여기에 있다. 만약 10대의 서버중에서 한 서버의 접속이 끊어졌다고 가정을 하면, 분단 허용성을 지원하지 않으므로 이는 수용할 수 있지만 끊어진 서버 때문에 일관성과 가용성이 훼손되므로 아예 1번 부터 10번까지 모든 서버를 중단시켜서 어떤 클라이언트도 서버와 접속할 수 없어야한다. 일반적으로 불가능한 방법이다.
> 

> 해결책은 간단한데, CA를 포기하면 된다. CA를 포기한다는 뜻이 극단적으로 일관성과 가용성을 포기하는 것이 아닌 1 ~ 100까지의 수치가 있을 때 일관성과 가용성을 100% 지원하던 것에서 수치를 60%로 낮춘다고 생각을 하면 된다.
> 

**대부분의 NoSQL 데이터베이스는 CA가 아닌 CP나 AP 시스템이다. 대용량의 분산 시스템을 구축하는데에는 CP보다도 AP가 알맞다. C가 들어가서 강력한 일관성 즉, ACID 트랜잭션을 지원한다고 가정하면 예를 들어 하나의 쓰기 작업을 수행한다고 가정할 때 2대가 정상 응답할 때까지 LOCK이 걸리겠지만 100대라면 너무 긴 시간동안 LOCK이 걸리게 된다.**

---

## 저장 방식에 따른 **NoSQL의 종류**

![https://blog.kakaocdn.net/dn/cgJiay/btrkgIMiwAx/OlvxwwPkHQSNezbxIW3CxK/img.png](https://blog.kakaocdn.net/dn/cgJiay/btrkgIMiwAx/OlvxwwPkHQSNezbxIW3CxK/img.png)

### 1. **키-값 데이터베이스 (Key-Value Model)**

- 프로그램을 하다보면 자주 만나게 되는 key-value 형태를 가지는 데이터베이스다.
- 데이터를 식별하기 위해서 key값을 알면 연결된 데이터를 확인할 수 있는 구조로 비교적 간단한 형태의 데이터베이스에 적합하다.

**키-값 데이터베이스의 구성요소**

**1) 키**

- 값을 가져오기 위한 식별자,  내에서 고유해야 한다.
    
    이름공간
    
- 이름공간이란 키-값 쌍을 묶어둔 것으로 데이터베이스라고 보면된다. 즉 키-값 데이터베이스 내에서 키는 중복될 수 없다. 다만 키가 다르다면 값은 얼마든지 중복되어도 관계없다.
- 키를 통해 값을 찾아와야 하므로 명명 규칙을 세워서 의미있는 값으로 만드는 것이 좋다 (RDBMS에서는 키값은 의미없는 숫자 등으로 생성)
- 키값을 처리하기 위해서 해시(Hash) 함수를 사용하기도 한다.

**2) 값**

- 키-값 데이터베이스에서 값의 데이터 타입에는 큰 제약이 없다.
- 정수, 실수, 문자열, BLOB, JSON 객체, 이미지, 오디오, list 등... 다양한 값이 들어갈 수 있다.

**단점과 한계점**

**1) 값 검색에 대한 한계**

- 키를 통해 값을 검색하고 수정 및 삭제를 진행할 수 있으나, 값을 기준으로 한 검색은 어렵다.

***=> 방법이 없는 것은 아니나 키를 기준으로 한 검색보다는 효율성이 떨어진다.***

- 값에 대해 텍스트 검색을 하는 방법 (Riak)
- 키만 사용해서 검색하는 경우 보조 인덱스 (Secondary Index)를 사용하여 값의 속성을 인덱스로 만들 수 있음

**2) 범위 질의를 지원하지 않음**

- 시작일 ~ 종료일 사이의 데이터를 검색하거나 특정 범위 내의 데이터를 검색하는 기능 없음
- 이 역시 보조 인덱스를 사용해서 기능을 보완해야 한다.

**3) RDBMS (관계형 데이터베이스) 의 SQL처럼 활용성 있는 질의언어가 없음**

- 간단한 조회를 위한 구조이므로 질의 언어가 없음
- 일부 데이터베이스의 경우 XML, JSON 등의 데이터 구조를 지원하므로 이를 이용해서 검색할 수 있다.

### 2. **문서 데이터베이스**

- 데이터 저장방식은 키-값 데이터베이스와 비슷하나, 값을 **문서**로 저장한다는 차이점이 있다.
- 여기서 말하는 문서란 반정형화된 엔티티로 XML, JSON 같은 형식이 이에 속한다. 워드나 엑셀 등의 문서 파일이 아니라는 점.

예를 들자면 다음과 같다.

```jsx
{  name : "ojava",  job : "programmer",  detail : "java"}
```

- 값에 하나의 형태만 들어갈 수 있는 키-값 데이터베이스와 달리, **문서는 여러 속성을 저장**할 수 있다.
- 고정된 스키마로 저장할 필요가 없으므로 높은 유연성을 지닌다.

***=> 개발자 입장에서는 필수적으로 입력되어야 하는 정보에 대해서 지정해주거나 체크하는 로직 필요***

- 문서에 하나의 값이 아닌 여러개의 속성을 지닐 뿐 아니라, 또 다른 문서를 중첩해서 입력할 수 있다.
- 질의어를 통해 데이터를 찾을 수 있다.

***=> db.employee.find({ detail: "java" }) 와 같이 쓰거나, AND, OR, = 등의 연산 검색이 가능하다.***

### 3. **컬럼 패밀리 데이터베이스**

- NoSQL 중 가장 복잡한 유형이다. 하나의 키에 여러 개의 컬럼 이름과 컬럼 값의 쌍으로 이루어진 데이터를 저장하고 조회한다. 모든 컬럼은 항상 타임 스탬프 값과 함께 저장된다.
- 저장의 기본 단위는 **컬럼**으로 컬럼은 **컬럼 이름**과 **컬럼 값**, **타임스탬프**로 구성된다. 이러한 컬럼들의 집합이 로우(Row)이며, 로우키(Row key)는 각 로우를 유일하게 식별하는 값이다. 이러한 로우들의 집합은 키 스페이스(Key Space)가 된다.
- 연관된 컬럼이 여러개가 있다면 묶어서 **'컬럼 패밀리'**로 만들어서 사용한다.
- 문서 데이터베이스와 비슷하게 고정된 스키마를 사용하지 않는다.
- 로우 별로 다른 데이터 형태를 가지므로 관계형 데이터베이스와 달리 조인이 불가능하다.

***=> 조인할 필요 없이 원하는 컬럼을 모아서 하나의 로우에 담는다고 한다.***

- 질의방법은 일반적인 SQL과 비슷하고, CREATE, COLUMNFAMILY 등 이에 특화된 기능도 존재한다.

### 4. **그래프 데이터베이스**

- 많은 객체와 각 연결 관계를 표현하는데 용이한 방법.
- SNS, 교통망, 전력망 등 연결 관계가 복잡한 형태의 데이터를 다루는데 사용되어진다.
- 노드 Node 와 관계 Relationship 또는 정점 vertext과 엣지 edge 라는 형태로 데이터를 표현하며, 노드는 구별할 수 있는 식별자와 여러 가지 속성을 가지고 관계는 두 노드 간의 연결을 말하며 연결에 대한 속성을 포함한다.

```jsx
ex)SNS : 노드가 되는 것은 '사람', 관계는 '사람 간의 연결, 관계'교통망 : 노드가 되는 것은 '지역', 관계는 '지역 간을 잇는 도로 등'
```

- 노드와 관계 모두 각각의 속성을 가지고 있다.
- 가까운 관계에 있는 노드들을 잇기 위한 목적으로 설계되었다.
- 관계형 데이터베이스로는 연산이 복잡한 작업을 그래프 데이터베이스로 대체할 수 있다.

---
